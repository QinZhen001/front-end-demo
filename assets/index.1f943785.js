import{r as d,j as l}from"./index.488414b2.js";class o{constructor(){this.deps=[]}addDep(t){this.deps.push(t)}notify(){this.deps.forEach(t=>t.update())}}class c{constructor(t,e,i,s){this.vm=t,this.key=e,this.cb=s,this.initVal=i,o.target=this,this.vm[this.key],o.target=null}update(){this.cb.call(this.vm,this.vm[this.key],this.initVal)}}class m{constructor(t,e){this.$vm=e,this.$el=document.querySelector(t),this.$el&&(this.$fragment=this.node2Fragment(this.$el),console.log("this.$fragment",this.$fragment),this.compile(this.$fragment),this.$el.appendChild(this.$fragment))}node2Fragment(t){const e=document.createDocumentFragment();let i;for(;i=t.firstChild;)e.appendChild(i);return e}compile(t){const e=t.childNodes;Array.from(e).forEach(i=>{i.nodeType===1?this.compileElement(i):i.nodeType==2||i.nodeType==3&&this.isInterpolation(i)&&this.compileText(i),i.childNodes&&i.childNodes.length>0&&this.compile(i)})}isInterpolation(t){return t.nodeType===3&&/\{\{(.*)\}\}/.test(t.textContent)}compileElement(t){let e=t.attributes;Array.from(e).forEach(i=>{const s=i.name,n=i.value;if(this.isDirective(s)){let h=`dir_${s.substring(2)}`;this[h]&&this[h](t,n)}else if(this.isEvent(s)){const a=s.substring(1);this.eventHandler(t,this.$vm,n,a)}})}isDirective(t){return t.indexOf("k-")===0}isEvent(t){return t.indexOf("@")===0}compileText(t){this.update("text",t,RegExp.$1)}update(t,e,i){let s=null;switch(t){case"text":s=this.updateText;const n=e.textContent;s(e,this.$vm[i],n),new c(this.$vm,i,n,function(a,h){s(e,a,h)});break;case"model":s=this.updateModel,s(e,this.$vm[i]),new c(this.$vm,i,null,function(a,h){s(e,a)});break}}eventHandler(t,e,i,s){const n=e.$options.methods&&e.$options.methods[i];s&&n&&t.addEventListener(s,n.bind(e))}dir_model(t,e){const i=this.$vm;this.update("model",t,e),t.addEventListener("input",s=>{i[e]=s.target.value})}dir_html(t,e){this.updateHtml(t,this.$vm[e])}dir_text(t,e){this.updateText(t,this.$vm[e])}updateHtml(t,e){t.innerHTML=e}updateText(t,e,i=""){if(!i){t.textContent=e;return}var s=/{{(.*)}}/gi,n=String(i.match(s)),a=i.replace(n,e);t.textContent=a}updateModel(t,e){t.value=e}}class u{constructor(t){this.$options=t,this.$data=t.data,this.observe(this.$data),new m(t.el,this),t.created&&t.created.call(this)}observe(t){!t||typeof t!="object"||Object.keys(t).forEach(e=>{t.hasOwnProperty(e)&&(this.defineReactive(t,e,t[e]),this.proxyData(e))})}defineReactive(t,e,i){const s=new o;Object.defineProperty(t,e,{get(){return o.target&&s.addDep(o.target),i},set(n){n!==i&&(i=n,console.log(`${e}\u66F4\u65B0\u4E86\uFF1A${n}`),s.notify())}}),this.observe(i)}proxyData(t){Object.defineProperty(this,t,{get(){return this.$data[t]},set(e){this.$data[t]=e}})}}const f=()=>{d.exports.useEffect(()=>{r(),t()},[]);const r=()=>{const e=document.getElementById("vue");e.innerHTML=`
      <div id="app">
        <div k-text="name"></div>
        <div>name: {{name}}</div>
        <div>{{age}}</div>
        <input type="text" k-model="name">
        <button @click="changeName">changeName</button>
        <div k-html="html"></div>
    </div>
    `},t=()=>{const e=new u({el:"#app",data:{name:"test",age:12,html:"<button>\u8FD9\u662F\u4E00\u4E2A\u6309\u94AE</button>"},created(){},methods:{changeName(){console.log("before change name: ",this.name),this.name="changeName",console.log("after change name: ",this.name)}}});window.vue=e,console.log("custom vue2: ",e)};return l("div",{id:"vue"})};export{f as default};
