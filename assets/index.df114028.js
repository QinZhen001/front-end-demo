import{r as y,a as p,j as f}from"./index.838b8fa6.js";let o,P=0,S=0,g="",h=new Map,m=[];window.operates=m;window.map=h;function D(n,s,i){var c="#"+(n<<16|s<<8|i).toString(16).padStart(6,"0");return c}function M(n,s){var i=!1;n[0]=="#"&&(n=n.slice(1),i=!0);var c=parseInt(n,16),v=(c>>16)+s;v>255?v=255:v<0&&(v=0);var w=(c>>8&255)+s;w>255?w=255:w<0&&(w=0);var d=(c&255)+s;return d>255?d=255:d<0&&(d=0),(i?"#":"")+(d|w<<8|v<<16).toString(16)}const R=()=>{const n=y.exports.useRef(null);let s=!1,i="",c=new Set;const v=()=>new Promise((e,r)=>{const t=new Image;t.src="/images/color_block.jpg",t.crossOrigin="Anonymous",t.onload=()=>{o.drawImage(t,0,0,n.current.width,n.current.height),e(!0)}}),w=()=>{o=n.current.getContext("2d",{willReadFrequently:!0});const{left:e,top:r}=n.current.getBoundingClientRect();P=e,S=r},d=(e,r)=>{const t=o.getImageData(e,r,1,1);var l=t.data[0],a=t.data[1],u=t.data[2];return D(l,a,u)},b=async()=>{let e=n.current.width,r=n.current.height,t=Date.now();for(let a=0;a<e-1;a++)for(let u=0;u<r-1;u++){let x=d(a,u);if(h.has(x))h.get(x).add([a,u]);else{let F=new Set;F.add([a,u]),h.set(x,F)}}for(let[a,u]of h)u.size<=100&&h.delete(a);let l=Date.now();console.log("cost time ",l-t),console.log("final map",h)},j=async()=>{w(),await v(),await b()};y.exports.useEffect(()=>{j()},[]);const E=e=>{let r=Math.floor(e.clientX-P),t=Math.floor(e.clientY-S);const l=d(r,t);g!==l&&(g=l,h.has(g)&&(C(),k()))},C=()=>{if(s){s=!1;return}for(;m.length;){const{color:e,data:r}=m.pop()||{};if(e&&r){o.beginPath(),o.fillStyle=e;for(let t of r){const[l,a]=t;o.rect(l,a,1,1)}o.fill(),o.closePath()}}},k=()=>{if(!g)return;const e=h.get(g);i=M(g,100),c=e,o.beginPath(),o.fillStyle=i;for(let r of e){const[t,l]=r;o.rect(t,l,1,1)}o.fill(),o.closePath(),m.push({color:g,data:e})};return p("div",{children:[f("section",{}),p("section",{className:"content",children:[p("div",{children:[f("h4",{children:"\u6A21\u7279\u56FE"}),f("img",{src:"/images/model.jpg",width:"300",height:"600"})]}),p("div",{children:[f("h4",{children:"\u8272\u5757\u56FE\uFF08\u539F\u56FE\uFF09"}),f("img",{src:"/images/color_block.jpg",width:"300",height:"600"})]}),p("div",{children:[f("h4",{children:"\u8272\u5757\u56FE\uFF08\u652F\u6301\u7528\u6237hover\u9AD8\u4EAE\uFF0C\u70B9\u51FB\u9009\u4E2D\uFF09"}),f("div",{className:"canvas-wrapper",children:f("canvas",{onMouseMove:E,onMouseLeave:()=>{g="",C()},onClick:()=>{s=!0,o.beginPath(),o.fillStyle=i;for(let e of c){const[r,t]=e;o.rect(r,t,1,1)}o.fill(),o.closePath(),m.pop(),m.push({color:i,data:c})},className:"my-canvas",width:300,height:600,ref:n})})]})]})]})};export{R as default};
