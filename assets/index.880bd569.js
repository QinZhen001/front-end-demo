import{r as y,a as b,j as w}from"./index.b674f20e.js";let a,j=0,M=0,f="",i=new Map,m=[];window.operates=m;window.map=i;function S(o,h,p){var c="#"+(o<<16|h<<8|p).toString(16).padStart(6,"0");return c}function D(o,h){var p=!1;o[0]=="#"&&(o=o.slice(1),p=!0);var c=parseInt(o,16),g=(c>>16)+h;g>255?g=255:g<0&&(g=0);var d=(c>>8&255)+h;d>255?d=255:d<0&&(d=0);var u=(c&255)+h;return u>255?u=255:u<0&&(u=0),(p?"#":"")+(u|d<<8|g<<16).toString(16)}const R=()=>{const o=y.exports.useRef(null),h=()=>new Promise((e,n)=>{const t=new Image;t.src="https://fullapp.oss-cn-beijing.aliyuncs.com/pic/264121695293447_.pic.jpg",t.crossOrigin="Anonymous",t.onload=()=>{a.drawImage(t,0,0,o.current.width,o.current.height),e(!0)}}),p=()=>{a=o.current.getContext("2d",{willReadFrequently:!0});const{left:e,top:n}=o.current.getBoundingClientRect();j=e,M=n},c=(e,n)=>{const t=a.getImageData(e,n,1,1);var s=t.data[0],r=t.data[1],l=t.data[2];return S(s,r,l)},g=async()=>{let e=o.current.width,n=o.current.height,t=Date.now();for(let r=0;r<e-1;r++)for(let l=0;l<n-1;l++){let v=c(r,l);if(i.has(v))i.get(v).add([r,l]);else{let x=new Set;x.add([r,l]),i.set(v,x)}}for(let[r,l]of i)l.size<=100&&i.delete(r);let s=Date.now();console.log("cost time ",s-t),console.log("final map",i)},d=async()=>{p(),await h(),await g()};y.exports.useEffect(()=>{d()},[]);const u=e=>{let n=Math.floor(e.clientX-j),t=Math.floor(e.clientY-M);const s=c(n,t);f!==s&&(f=s,i.has(f)&&(C(),P()))},C=()=>{for(;m.length;){const{color:e,data:n}=m.pop()||{};if(e&&n){console.log("restore drawColor",e),a.beginPath(),a.fillStyle=e;for(let t of n){const[s,r]=t;a.rect(s,r,1,1)}a.fill(),a.closePath()}}},P=()=>{if(!f)return;const e=i.get(f);let n=D(f,50);console.log("highlight drawColor",n),a.beginPath(),a.fillStyle=n;for(let t of e){const[s,r]=t;a.rect(s,r,1,1)}a.fill(),a.closePath(),m.push({color:f,data:e})};return b("div",{children:[w("section",{}),w("section",{className:"content",children:w("div",{className:"canvas-wrapper",children:w("canvas",{onMouseMove:u,onMouseLeave:()=>{f="",C()},className:"my-canvas",width:300,height:600,ref:o})})})]})};export{R as default};
